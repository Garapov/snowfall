{"version":3,"file":"snowfall.min.js","sources":["../src/snowflake.js","../src/index.js"],"sourcesContent":["export class Snowflake {\n    constructor(x, y, radius, speed, wind) {\n        // Store initial properties for reuse\n        this.initialX = x;\n        this.initialRadius = radius;\n        this.initialSpeed = speed;\n        \n        // Current state\n        this.x = x;\n        this.y = y;\n        this.radius = radius;\n        this.speed = speed;\n        this.wind = wind;\n        this.isReset = false;\n    }\n\n    update(canvasHeight, wind) {\n        this.y += this.speed;\n        this.x += wind;\n\n        // Simple bounds check\n        this.isReset = this.y > canvasHeight + this.radius * 2;\n    }\n\n    draw(ctx) {\n        // Skip drawing if offscreen\n        if (this.y < -this.radius * 2) return;\n        \n        // Use optimized circle drawing\n        ctx.beginPath();\n        ctx.arc(this.x | 0, this.y | 0, this.radius, 0, 6.283); // 6.283 â‰ˆ 2 * Math.PI, avoid calculation\n        ctx.fillStyle = 'white';\n        ctx.fill();\n    }\n\n    reset(x, y) {\n        this.x = x;\n        this.y = y;\n        this.isReset = false;\n    }\n}","import { Snowflake } from './snowflake';\n\nexport class SnowfallCanvas {\n    constructor(canvas, options = {}) {\n        this.canvas = canvas;\n        this.ctx = canvas.getContext('2d', { alpha: false }); // Optimize for non-transparent background\n        \n        // Default options\n        this.options = {\n            count: options.count || 100,\n            minRadius: options.minRadius || 2,\n            maxRadius: options.maxRadius || 5,\n            minSpeed: options.minSpeed || 1,\n            maxSpeed: options.maxSpeed || 3,\n            wind: options.wind || 0,\n            color: options.color || 'white',\n            opacity: options.opacity || 0.8,\n            ...options\n        };\n\n        this.snowflakes = new Array(this.options.count); // Pre-allocate array\n        this.isRunning = false;\n        this.animationFrame = null;\n        this.lastTime = 0;\n        this.frameInterval = 1000 / 60; // Target 60 FPS\n\n        // Bind methods that are used in animation loop\n        this.animate = this.animate.bind(this);\n\n        // Initialize after setting canvas dimensions\n        this.resize();\n        this.init();\n\n        // Debounced resize handler\n        let resizeTimeout;\n        window.addEventListener('resize', () => {\n            if (resizeTimeout) clearTimeout(resizeTimeout);\n            resizeTimeout = setTimeout(() => {\n                this.resize();\n                // Redistribute snowflakes across the new canvas width\n                const width = this.canvas.width;\n                this.snowflakes.forEach(snowflake => {\n                    snowflake.x = Math.random() * width;\n                });\n            }, 150);\n        });\n    }\n\n    init() {\n        const { width, height } = this.canvas;\n        \n        // Create snowflakes in a single loop\n        for (let i = 0; i < this.options.count; i++) {\n            const x = Math.random() * width;\n            const y = Math.random() * height - height; // Start above the canvas\n            this.snowflakes[i] = this.createSnowflake(x, y);\n        }\n    }\n\n    createSnowflake(x = null, y = null) {\n        const { minRadius, maxRadius, minSpeed, maxSpeed, wind } = this.options;\n        \n        const radius = Math.random() * (maxRadius - minRadius) + minRadius;\n        // Calculate speed based on radius - bigger snowflakes fall faster\n        const radiusRatio = (radius - minRadius) / (maxRadius - minRadius);\n        const speed = minSpeed + (maxSpeed - minSpeed) * radiusRatio;\n        \n        x = x ?? Math.random() * this.canvas.width;\n        y = y ?? Math.random() * -this.canvas.height;\n\n        return new Snowflake(x, y, radius, speed, wind);\n    }\n\n    resize() {\n        const { offsetWidth, offsetHeight } = this.canvas;\n        this.canvas.width = offsetWidth;\n        this.canvas.height = offsetHeight;\n        \n        // Set constant properties\n        this.ctx.fillStyle = 'white';\n    }\n\n    start() {\n        if (!this.isRunning) {\n            this.isRunning = true;\n            this.lastTime = performance.now();\n            this.animate();\n        }\n    }\n\n    stop() {\n        this.isRunning = false;\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n            this.animationFrame = null;\n        }\n    }\n\n    animate(currentTime = 0) {\n        if (!this.isRunning) return;\n\n        // Control frame rate\n        const elapsed = currentTime - this.lastTime;\n        if (elapsed < this.frameInterval) {\n            this.animationFrame = requestAnimationFrame(this.animate);\n            return;\n        }\n        this.lastTime = currentTime - (elapsed % this.frameInterval);\n\n        const { width, height } = this.canvas;\n        const { wind } = this.options;\n        \n        this.ctx.fillStyle = '#1a1a1a';\n        this.ctx.fillRect(0, 0, width, height);\n        \n        // Update and draw in a single loop\n        for (let i = 0; i < this.snowflakes.length; i++) {\n            const snowflake = this.snowflakes[i];\n            snowflake.update(height, wind);\n            \n            if (snowflake.isReset) {\n                const x = Math.random() * width;\n                // When resetting, recalculate speed based on radius\n                const radiusRatio = (snowflake.radius - this.options.minRadius) / (this.options.maxRadius - this.options.minRadius);\n                snowflake.speed = this.options.minSpeed + (this.options.maxSpeed - this.options.minSpeed) * radiusRatio;\n                snowflake.wind = wind;\n                snowflake.reset(x, -10);\n            }\n            \n            snowflake.draw(this.ctx);\n        }\n\n        this.animationFrame = requestAnimationFrame(this.animate);\n    }\n\n    updateOptions(newOptions) {\n        const oldOptions = { ...this.options };\n        this.options = { ...this.options, ...newOptions };\n        \n        // Update snowflakes count if needed\n        if (newOptions.count !== undefined) {\n            const diff = newOptions.count - this.snowflakes.length;\n            \n            if (diff > 0) {\n                // Add more snowflakes\n                const currentLength = this.snowflakes.length;\n                for (let i = 0; i < diff; i++) {\n                    this.snowflakes[currentLength + i] = this.createSnowflake();\n                }\n            } else if (diff < 0) {\n                // Remove excess snowflakes\n                this.snowflakes.length = newOptions.count;\n            }\n        }\n\n        // Cache frequently accessed values\n        const { minRadius, maxRadius, minSpeed, maxSpeed, wind } = this.options;\n\n        // Update sizes and speeds if radius changes\n        if (newOptions.minRadius !== undefined || newOptions.maxRadius !== undefined) {\n            const oldRadiusRange = oldOptions.maxRadius - oldOptions.minRadius;\n            const newRadiusRange = maxRadius - minRadius;\n            \n            this.snowflakes.forEach(snowflake => {\n                // Keep the same relative size ratio when updating radius\n                const oldRadiusRatio = (snowflake.radius - oldOptions.minRadius) / oldRadiusRange;\n                \n                // Calculate new radius maintaining the same relative position in the range\n                snowflake.radius = minRadius + (oldRadiusRatio * newRadiusRange);\n                \n                // Update speed based on new radius\n                const radiusRatio = (snowflake.radius - minRadius) / newRadiusRange;\n                snowflake.speed = minSpeed + (maxSpeed - minSpeed) * radiusRatio;\n            });\n        }\n\n        // Update wind for all snowflakes if wind changes\n        if (newOptions.wind !== undefined) {\n            this.snowflakes.forEach(snowflake => {\n                snowflake.wind = wind;\n            });\n        }\n    }\n}"],"names":["Snowflake","constructor","x","y","radius","speed","wind","this","initialX","initialRadius","initialSpeed","isReset","update","canvasHeight","draw","ctx","beginPath","arc","fillStyle","fill","reset","SnowfallCanvas","canvas","options","resizeTimeout","getContext","alpha","count","minRadius","maxRadius","minSpeed","maxSpeed","color","opacity","snowflakes","Array","isRunning","animationFrame","lastTime","frameInterval","animate","bind","resize","init","window","addEventListener","clearTimeout","setTimeout","width","forEach","snowflake","Math","random","height","i","createSnowflake","offsetWidth","offsetHeight","start","performance","now","stop","cancelAnimationFrame","currentTime","elapsed","requestAnimationFrame","fillRect","length","radiusRatio","updateOptions","newOptions","oldOptions","undefined","diff","currentLength","oldRadiusRange","newRadiusRange","oldRadiusRatio"],"mappings":"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"}